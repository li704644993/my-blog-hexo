---
title: "JS中的排序方法sort的探究"
date: 2017-05-09
categories: JavaScript
description: 使用sort在chrome浏览器下排序偶尔会出现问题，即对短数组（长度小于10）时，对不需要调换顺序的元素依然调换了顺序，特意研究一下。
tags: 
- JavaScript
---


## 关于sort()方法排序问题。
### 坑  
#### [10, 20, 1, 2].sort(); // [1, 10, 2, 20]  
#### 因为Array的sort()方法默认把所有元素先转换为String再排序，结果'10'排在了'2'的前面，因为字符'1'比字符'2'的ASCII码小。

#### 深坑  

```
var arr = [{'name':'tony','age':17},{'name':'sendy','age':18},{'name':'jone','age':20},{'name':'lily','age':19},{'name':'lily1','age':19},{'name':'lily2','age':19},{'name':'lily3','age':19},{'name':'lily4','age':19},{'name':'lily5','age':19},{'name':'lily6','age':19}];  
```

如上，arr为一个对象数组，我们按照对象的age属性使用sort排序。得到正确的排序结果。  
但是当改数组长度增加时，会得到逻辑不合理的结果。  

- 该现象仅在使用chrome内核时出现，firefox、safari、Edge等其他主流浏览器均未出现。
  
#### 原因分析  
chrome引擎对sort方法的优化方案里，在短数组的排序中使用了稳定的排序方法，但是对于长数组，使用了不稳定的排序方法（快速、选择、希尔等）。  
#### 原因寻找  
chrome v8引擎对sort的具体实现是一种优化过的快速排序算法：

- 小数组（小于10项）采用插入排序提升效率（小数组排序正常的原因）
- 一般数组采用三数取中获得基准元素
- 超过2000项的大数组采用更复杂的规则获得基准元素（这条和上面一条降低算法进入最差情况的几率，特别是对于已排序的数组意义很大）
- 分区时会分成小于基准、等于基准、大于基准三个分区（解决数组元素相同时快速排序算法效率极差的问题）
- 对于小于基准和大于基准这两个分区，选择项数少的进行递归，项数多的进行循环，有效降低递归深度
