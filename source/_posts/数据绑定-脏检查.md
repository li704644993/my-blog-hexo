---
title: "Angular双向绑定脏检测的研究"
date: 2017-10-11
categories: Angular
description: 以前老听说Angular实现双向绑定通过脏检测，但对于脏检测的说法不甚明了，最近收集了一些网络的说法，加之自己的理解，写下来，以后有更确切的研究了再进行更新。
tags: 
- Angular
- JavaScript
---

## Angular数据绑定的研究

#### 数据什么时候变化  

- 用户输入操作：点击、提交等。
- 请求了服务端数据。
- setTimeOut、setInterval。

可以看出，他们都是异步的，那么可以说，异步就是导致数据变化的根本原因。  

#### 怎么获取变化  
在AngularJS中使用的是脏检查。
>脏检查其实就是存储所有变量的值，每当可能有变量发生变化需要检查时，就将所有变量的旧值跟新值进行比较，不相等就说明检测到变化，需要更新对应视图。

Angular中，官方宣称对脏检查进行了改善。Angular其实并没有一个双向绑定的实现,它的双向绑定就是数据绑定+事件绑定。

Angular官方给的例子：

```
<input 
[value]="currentHero.name" 
(input)="currentHero.name=$event.target.value" 
>
```
这是个input控件的双向绑定语法,很清楚的说明了双向绑定与两个单向绑定的关系.

这里没有用ngModule语法.ngModule语法内部实现与这个差不多.  

事件绑定原理很简单:

1. 用户操作触发ＤＯＭ事件通知
2. Angular监听到了通知,然后执行模板语法,这里就是将input控件的输入赋值给了currentHero.name.

那么数据绑定呢？


Angular的核心是组件化，组件的嵌套会使得最终形成一棵组件树。Angular的变化检测可以分组件进行，每个组件都有对应的变化检测器ChangeDetector。可想而知，这些变化检测器也会构成一棵树。

另外，Angular的数据流是自顶而下，从父组件到子组件单向流动。单向数据流向保证了高效、可预测的变化检测。尽管检查了父组件之后，子组件可能会改变父组件的数据使得父组件需要再次被检查，这是不被推荐的数据处理方式。在开发模式下，Angular会进行二次检查，如果出现上述情况，二次检查就会报错。而在生产环境中，脏检查只会执行一次。

相比之下，AngularJS采用的是双向数据流，错综复杂的数据流使得它不得不多次检查，使得数据最终趋向稳定。理论上，数据可能永远不稳定。AngularJS给出的策略是，脏检查超过10次，就认为程序有问题，不再进行检查。